seed: 42
accelerator: "cuda"
default_root_dir: "results"

tiling:
  image_size: [512, 512]
  tile_size: [256, 256]
  stride: 256

normalization_stage: image # on what level we normalize, options: [tile, image, none]
thresholding_stage: image # stage at which we apply threshold, options: [tile, image]

data:
  class_path: anomalib.data.Folder
  init_args:
    name: pcb  # 数据集名称
    root: datasets/pcb  # 根目录
    normal_dir: good  # 正常图像目录（206张png）
    abnormal_dir: defect  # 异常图像目录（6张jpeg）
    normal_test_dir: null  # 没有单独的测试目录，会从normal_dir中分割
    mask_dir: null  # 没有mask目录
    normal_split_ratio: 0.2  # 从good目录中分割20%作为正常测试样本
    extensions: [".png", ".jpeg", ".jpg"]  # 支持的图像格式
    train_batch_size: 4
    eval_batch_size: 4
    num_workers: 2

    train_augmentations:
      # PCB背景裁剪
      - class_path: anomalib.data.transforms.pcb_crop_transform.PCBBackgroundCropV2
        init_args:
          padding: 10  # 裁剪边距（像素）
          min_area_ratio: 0.1  # PCB最小面积占比（过滤误检）
      # 数据增强
      - class_path: torchvision.transforms.v2.RandomRotation
        init_args:
          degrees: 15  # 随机旋转范围：-15度到+15度
      - class_path: torchvision.transforms.v2.ColorJitter
        init_args:
          brightness: 0.2  # 亮度变化范围：-20%到+20%
          contrast: 0.2  # 对比度变化范围：-20%到+20%

    val_augmentations: null
    test_augmentations: null
    augmentations: null
    test_split_mode: from_dir
    test_split_ratio: 0.2
    val_split_mode: same_as_test
    val_split_ratio: 0.5
    seed: null

SeamSmoothing:
  apply: True # if this is applied, area around tile seams are is smoothed
  sigma: 2 # sigma of gaussian filter used to smooth this area
  width: 0.1 # width factor, multiplied by tile dimension gives the region width around seam which will be smoothed

TrainModels:
  model:
    class_path: Patchcore

  trainer:
    max_epochs: 1  # PatchCore只需要1个epoch
    callbacks: null  # 移除EarlyStopping，因为PatchCore不需要多轮训练